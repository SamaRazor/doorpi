# Протокол Bicycle v1.0

## Описание

Bicycle — простой протокол общения контроллера для умного дома ("железка") и сервера.

Железка может содержать один или несколько датчиков, а также один управляемый программно переключатель. 

## Общий вид запроса
    
    Bicycle/1.0
    src: <string>
    dest: <string>
    time: <uint64>
    req-type: <string>
    [специальные параметры]
    End-Bicycle

## Общий вид ответа

    Bicycle/1.0 <code>

где \<code> — uint32, содержащий код ошибки:

* 200 — OK
* 400 — Bad Request (некорректно составлен запрос)

## Общие параметры запроса

* `src`: строка; отправитель, имя железки, "server" или другой идентификатор
* `dest`: строка; адресат, например, "server"
* `time`: uint64; системное время железки в миллисекундах от старта работы железки 
* `req-type`: строка из списка ниже

## Специальные параметры запроса

В этой секции перечислены req-type и соответствующие им специальные параметры.

* `auth`
    * железка —> сервер
    * Приветствие железки серверу. Мотивация — чтобы сервер запомнил, что железка есть, записал время и мониторил её. При разрыве TCP-соединения железка считается отсоединённой.
    * Специальных параметров нет.

* `dump`
    * железка —> сервер
    * Передача значений датчиков.
    * `sensor-<id>: <sensor-value>`
        * \<id> и \<sensor-value> — строки

* `action-once` 
    * сервер —> железка
    * Команда железке сделать что-то сейчас.
    * `set-now: <string>` — какое значение установить сейчас

* `action-schedule`
    * сервер —> железка
    * Команда железке сделать что-то сейчас, плюс триггер на потом.
    * `set-now: <string>` — какое значение установить сейчас
    * `trigger-type: <string>` — какой датчик является триггером ("time", "temperature", "humidity" и т.д.)
    * `trigger-value: <string>` — значение триггера в формате, подходящем для железки
    * `trigger-condition: <condition>`, где
        \<condition> ::= "less-than" | "greater-than"
    * `set-on-triggered: <string>` — какое значение установить при триггере

Порядок строк в запросе — произвольный.
